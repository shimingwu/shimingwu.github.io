<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Distributed Database System (6) | Shiming&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="This is revision note for NUS master study of CS5424 Distributed Databases. One-Copy Database One-copy serializable (1SR) Mutual Consistency Strong mutual consistency Weak mutual consistency    Replic">
<meta property="og:type" content="article">
<meta property="og:title" content="Distributed Database System (6)">
<meta property="og:url" content="https://shimingwu.github.io/2020/11/26/Distributed-Database-System-6/index.html">
<meta property="og:site_name" content="Shiming&#39;s Blog">
<meta property="og:description" content="This is revision note for NUS master study of CS5424 Distributed Databases. One-Copy Database One-copy serializable (1SR) Mutual Consistency Strong mutual consistency Weak mutual consistency    Replic">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://shimingwu.github.io/2020/11/26/Distributed-Database-System-6/replication_protocols.png">
<meta property="article:published_time" content="2020-11-26T12:42:58.000Z">
<meta property="article:modified_time" content="2020-12-02T13:44:01.079Z">
<meta property="article:author" content="Shiming Wu">
<meta property="article:tag" content="Distributed Database">
<meta property="article:tag" content="Data Structure">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://shimingwu.github.io/2020/11/26/Distributed-Database-System-6/replication_protocols.png">
  
    <link rel="alternate" href="/atom.xml" title="Shiming&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Shiming&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://shimingwu.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Distributed-Database-System-6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/26/Distributed-Database-System-6/" class="article-date">
  <time datetime="2020-11-26T12:42:58.000Z" itemprop="datePublished">2020-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Distributed Database System (6)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is revision note for NUS master study of CS5424 Distributed Databases.</p>
<h2 id="One-Copy-Database"><a href="#One-Copy-Database" class="headerlink" title="One-Copy Database"></a>One-Copy Database</h2><ul>
<li>One-copy serializable (1SR)</li>
<li>Mutual Consistency<ul>
<li>Strong mutual consistency</li>
<li>Weak mutual consistency</li>
</ul>
</li>
</ul>
<h2 id="Replicas-Update"><a href="#Replicas-Update" class="headerlink" title="Replicas Update"></a>Replicas Update</h2><ul>
<li>DBMS-level replication<ul>
<li>Statement-based replication<br>直接发statement</li>
<li>Write-ahead log (WAL) shipping </li>
</ul>
</li>
<li>Application-level replication</li>
</ul>
<h2 id="Replication-Protocols"><a href="#Replication-Protocols" class="headerlink" title="Replication Protocols"></a>Replication Protocols</h2><img src="/2020/11/26/Distributed-Database-System-6/replication_protocols.png" class="" title="replication_protocols">

<h3 id="When-are-updates-propagated-to-copies"><a href="#When-are-updates-propagated-to-copies" class="headerlink" title="When are updates propagated to copies"></a>When are updates propagated to copies</h3><ul>
<li>Eager (Synchronous) update:<ul>
<li>Strong mutual consistency</li>
<li>Based on read-one-write-all (ROWA) protocols</li>
</ul>
</li>
<li>Lazy (Asynchronous) update:<ul>
<li>Need to ensure that updates are applied in the <strong>same order</strong> to all replicas</li>
</ul>
</li>
</ul>
<h3 id="Where-are-updates-allowed-to-occur"><a href="#Where-are-updates-allowed-to-occur" class="headerlink" title="Where are updates allowed to occur"></a>Where are updates allowed to occur</h3><ul>
<li>Centralized technique:<ul>
<li>Master copy updated first</li>
</ul>
</li>
<li>Distributed technique:<ul>
<li>Any site can update first</li>
</ul>
</li>
</ul>
<h3 id="Protocols"><a href="#Protocols" class="headerlink" title="Protocols"></a>Protocols</h3><ul>
<li>Eager Centralized Protocols<ul>
<li>Eager Single-Master Protocol: 有一个single master，同时也是lock manager。<ul>
<li>Read：由TC问一下master拿S-lock，从哪个site读都行</li>
<li>Write：由TC问一下master拿X-lock，master进行写操作，再保证其他site也进行写操作。</li>
</ul>
</li>
<li>Eager Primary Copy Protocol: master有着primary copy。更新不同的数据，master不一样。其他和single-master一样。</li>
</ul>
</li>
<li>Eager Distributed Protocols<ul>
<li>Read：先看看自己有没有数据备份，有的话，直接读，没有的话，则问别人</li>
<li>Write：先看看自己有没有数据备份，有的话，直接写，没有的话，则问别人</li>
</ul>
</li>
<li>Lazy Centralized Protocols<ul>
<li>Lazy Single Master: There is a single master site containing master copies of all objects</li>
<li>Refresh transaction</li>
<li>一个T被commit后，master告诉TC结束了，用同一个order对其他的site进行更新。更新使用refresh transaction的方式。</li>
</ul>
</li>
<li>Lazy Distributed Protocols</li>
</ul>
<blockquote>
<p>In lazy protocol, the execution is not necessary 1SR</p>
</blockquote>
<h2 id="Last-Writer-Wins-Heuristic"><a href="#Last-Writer-Wins-Heuristic" class="headerlink" title="Last-Writer-Wins Heuristic"></a>Last-Writer-Wins Heuristic</h2><p>为了避免写的冲突导致replicas的状态不一致，后发生的write会直接无视前一个write写的值直接执行覆盖。（blind write）</p>
<h2 id="Quorum-Consensus-QC-Protocol"><a href="#Quorum-Consensus-QC-Protocol" class="headerlink" title="Quorum Consensus (QC) Protocol"></a>Quorum Consensus (QC) Protocol</h2><ol>
<li><p>Tr (O) + Tw(O) &gt; Wt(O)</p>
</li>
<li><p>2 × Tw(O) &gt; Wt(O)</p>
</li>
<li><p>The sum of read and write threshold must exceed the total weights of all replicas. This helps to ensure any next subsequent read operation will read an updated value performed by write.</p>
</li>
<li><p>2 * Tw(O) &gt; Wt(O) : Prevent two concurrent write operations.</p>
</li>
</ol>
<h2 id="Handling-Failures"><a href="#Handling-Failures" class="headerlink" title="Handling Failures"></a>Handling Failures</h2><ul>
<li>Failure of Slave Sites<ul>
<li>Lazy replication<ul>
<li>Synchronize unavailable replicas later when they become available</li>
</ul>
</li>
<li>Eager replication<ul>
<li>ROWA (Read-One/Write-All)</li>
<li>ROWAA (Read-One/Write-All Available)<blockquote>
<p>Relaxation of ROWA protocol. Do not require updating of all replicas but only available replicas.</p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
<li>Failure of Master Site<ul>
<li>Elect a new master site<ul>
<li>选择想要的partition。如果多个partition且每个partition都有一个master，会产生数据不一致的问题。选择partition的算法：<ol>
<li>Simple algorithm</li>
<li>Majority consensus algorithm</li>
<li>Quorum consensus algorithm</li>
</ol>
</li>
<li>如果选择的partition没有可以工作的master，则选举新的master<ol>
<li>Consensus algorithm</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Simple-Algorithm"><a href="#Simple-Algorithm" class="headerlink" title="Simple Algorithm"></a>Simple Algorithm</h3><p>选择有可用master的partition。</p>
<h3 id="Majority-Consensus-Algorithm"><a href="#Majority-Consensus-Algorithm" class="headerlink" title="Majority Consensus Algorithm"></a>Majority Consensus Algorithm</h3><p>选择node数多的（大于一半数量）的partition。</p>
<h3 id="Quorum-Consensus-Algorithm"><a href="#Quorum-Consensus-Algorithm" class="headerlink" title="Quorum Consensus Algorithm"></a>Quorum Consensus Algorithm</h3><p>有权重。选择权重大的作为新的partition。</p>
<h2 id="CAP-Theorem"><a href="#CAP-Theorem" class="headerlink" title="CAP Theorem"></a>CAP Theorem</h2><h3 id="CAP"><a href="#CAP" class="headerlink" title="CAP"></a>CAP</h3><ul>
<li><p>Data Consistency</p>
</li>
<li><p>System Availability</p>
</li>
<li><p>Tolerance to Network Partitions</p>
</li>
<li><p>Forfeit consistency (丧失一致性)</p>
<ul>
<li>Resume execution on a selected partition</li>
<li>Data could become inconsistent if the selected partition requires a new master site</li>
</ul>
</li>
<li><p>Forfeit availability （丧失可用性）</p>
<ul>
<li>Wait for network to recover before resuming execution</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/11/26/Distributed-Database-System-6/" data-id="cki7gopf80019zprveysj965c" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Distributed-Database/" rel="tag">Distributed Database</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2020/11/26/Distributed-Database-System-7/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Distributed Database System (7)
        
      </div>
    </a>
  
  
    <a href="/2020/11/22/Distributed-Database-System-5/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Distributed Database System (5)</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/" rel="tag">Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Big-Data/" rel="tag">Big Data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Data-Structure/" rel="tag">Data Structure</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Distributed-Database/" rel="tag">Distributed Database</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VueJs/" rel="tag">VueJs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%8F%E8%AE%AE/" rel="tag">协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8%E6%80%A7/" rel="tag">安全性</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algorithm/" style="font-size: 12.5px;">Algorithm</a> <a href="/tags/Big-Data/" style="font-size: 17.5px;">Big Data</a> <a href="/tags/Data-Structure/" style="font-size: 20px;">Data Structure</a> <a href="/tags/Distributed-Database/" style="font-size: 20px;">Distributed Database</a> <a href="/tags/LeetCode/" style="font-size: 12.5px;">LeetCode</a> <a href="/tags/VueJs/" style="font-size: 10px;">VueJs</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15px;">前端</a> <a href="/tags/%E5%8D%8F%E8%AE%AE/" style="font-size: 10px;">协议</a> <a href="/tags/%E5%AE%89%E5%85%A8%E6%80%A7/" style="font-size: 12.5px;">安全性</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">架构</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 12.5px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/26/Distributed-Database-System-9/">Distributed Database System (9)</a>
          </li>
        
          <li>
            <a href="/2020/11/26/Distributed-Database-System-8/">Distributed Database System (8)</a>
          </li>
        
          <li>
            <a href="/2020/11/26/Distributed-Database-System-7/">Distributed Database System (7)</a>
          </li>
        
          <li>
            <a href="/2020/11/26/Distributed-Database-System-6/">Distributed Database System (6)</a>
          </li>
        
          <li>
            <a href="/2020/11/22/Distributed-Database-System-5/">Distributed Database System (5)</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Shiming Wu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>