<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Shiming Wu"><title>BigData(3) · Shiming's Blog</title><meta name="description" content="This is revision note for NUS master study of CS5425 Big Data Systems for Data Science.
Relational DatabaseUsually, Hadoop/MapReduce is used to support the OLAP.
Relational AlgebraConsidering the table Employee. All examples will use the table.
Projection Π

 Employee  Π NAME, AGE (Employee) 





I"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"><script src="/js/jquery.js"></script><meta name="generator" content="Hexo 4.2.1"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/logo@2x.png" style="width:127px;"><h3 title=""><a href="/">Shiming's Blog</a></h3><div class="description"><p>寄言燕雀莫相啅， 自有云霄万里高。<br> It will remain our secret, our very own story, for no one to tell.</p></div></div></div><ul class="social-links"><li><a href="https://github.com/shimingwu" target="_blank" rel="noopener"><i class="fa fa-github"></i></a></li><li><a href="mailto:wushiming1027@gmail.com"><i class="fa fa-envelope"></i></a></li></ul><div class="footer"><div class="p"> <span>©  </span><i class="fa fa-star"></i><span> Shiming Wu</span></div><div class="by_farbox"><span>Powered by </span><a href="https://hexo.io/zh-cn/" target="_blank">Hexo </a><span> & </span><a href="https://github.com/mrcore/hexo-theme-Anatole-Core" target="_blank">Anatole-Core  </a></div></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/archives">归档</a></li></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>BigData(3)</a></h3></div><div class="post-content"><p>This is revision note for NUS master study of CS5425 Big Data Systems for Data Science.</p>
<h2 id="Relational-Database"><a href="#Relational-Database" class="headerlink" title="Relational Database"></a>Relational Database</h2><p>Usually, Hadoop/MapReduce is used to support the OLAP.</p>
<h3 id="Relational-Algebra"><a href="#Relational-Algebra" class="headerlink" title="Relational Algebra"></a>Relational Algebra</h3><p>Considering the table <code>Employee</code>. All examples will use the table.</p>
<p><strong>Projection Π</strong></p>
<table>
<tr><th> Employee </th><th> Π NAME, AGE (Employee) </th></tr>
<tr><td>

<table>
<thead>
<tr>
<th align="left">ID</th>
<th align="center">NAME</th>
<th align="left">AGE</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="center">Mike</td>
<td align="left">12</td>
</tr>
<tr>
<td align="left">2</td>
<td align="center">Jane</td>
<td align="left">22</td>
</tr>
<tr>
<td align="left">3</td>
<td align="center">Vincent</td>
<td align="left">45</td>
</tr>
</tbody></table>
</td><td>

<table>
<thead>
<tr>
<th align="center">NAME</th>
<th align="left">AGE</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Mike</td>
<td align="left">12</td>
</tr>
<tr>
<td align="center">Jane</td>
<td align="left">22</td>
</tr>
<tr>
<td align="center">Vincent</td>
<td align="left">45</td>
</tr>
</tbody></table>
</td></tr> </table>

<p>To perform projection, only mapper is used. The bottleneck is the streaming read speed of HDFS.</p>
<p><strong>Selection σ</strong></p>
<table>
<tr><th> Employee </th><th> σ ID = 1 (Employee) </th></tr>
<tr><td>

<table>
<thead>
<tr>
<th align="left">ID</th>
<th align="center">NAME</th>
<th align="left">AGE</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="center">Mike</td>
<td align="left">12</td>
</tr>
<tr>
<td align="left">2</td>
<td align="center">Jane</td>
<td align="left">22</td>
</tr>
<tr>
<td align="left">3</td>
<td align="center">Vincent</td>
<td align="left">45</td>
</tr>
</tbody></table>
</td><td>

<table>
<thead>
<tr>
<th align="left">ID</th>
<th align="center">NAME</th>
<th align="left">AGE</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="center">Mike</td>
<td align="left">12</td>
</tr>
</tbody></table>
</td></tr> </table>

<p>To perform projection, only mapper is used. The bottleneck is the streaming read speed of HDFS. Selection is very similar to Projection in general.</p>
<p><strong>Group By (Aggregation)</strong></p>
<p>This can be done via mapper + reducer. In addition, combiner can be used to optimize the performance. </p>
<p><strong>Order By</strong></p>
<p>There are two sort problems here: Sort by <strong>Key</strong> and Sort by <strong>Value</strong>.</p>
<p>In terms of sort by key, MapReduce (Hadoop) guarantees the order of keys are sorted before sending to the reducers. If a tuple only has a single column, for example, {‘Apple’, 1}, then the sort is very simple.</p>
<p>However, what if there are multiple columns exist for a tuple, for example, {‘Apple’, ‘2020-10-2’, 1}. If we want to sort by the fruit name, followed by the sort of date, there are 2 main approaches:</p>
<ul>
<li><code>Sort inside Reducer (BAD)</code></li>
<li><code>Value-to-Key (BETTER)</code></li>
</ul>
<blockquote>
<p>For the first approach, it involves having the reducer buffer all of the values for a given key and do an in-reducer sort. Since the reducer will be receiving all values for a given key, this approach could possibly cause the reducer to run out of memory. </p>
</blockquote>
<table>
<tr>
  <th> Map </th>
  <th> Shuffle and Sort (by the key) </th>
  <th> Reduce </th>
</tr>
<tr>

<td>

<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="center">Value 1</th>
<th align="left">Value 2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left"></td></td>
<td align="center"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><td></td>
<td align="center"></td>
<td align="left"></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="center">Values under the key</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Apple</td>
<td align="center">(‘2020-10-2’, 10)<br/> <strong>(‘2020-10-5’, 20)</strong><br/> <strong>(‘2020-10-2’, 10)</strong><br/> (‘2020-10-5’, 20)</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">(‘2020-10-5’, 20)<br/> (‘2020-10-5’, 20)</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">(‘2020-10-2’, 10)<br/> (‘2020-10-2’, 10)</td>
</tr>
</tbody></table>
</td>
<td>

<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="center">Values under the key</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Apple</td>
<td align="center">(‘2020-10-2’, 10)<br/>  <strong>(‘2020-10-2’, 10)</strong><br/> <strong>(‘2020-10-5’, 20)</strong><br/>(‘2020-10-5’, 20)</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">(‘2020-10-5’, 20)<br/> (‘2020-10-5’, 20)</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">(‘2020-10-2’, 10)<br/> (‘2020-10-2’, 10)</td>
</tr>
<tr>
<td align="left"></td></td>
<td align="center"></td>
</tr>
<tr>
<td align="left"></tr></td>
<td align="center"></td>
</tr>
</tbody></table>
</table>

<blockquote>
<p>The second approach involves creating a composite key by adding a part of, or the entire value to the natural key to achieve your sorting objectives. </p>
</blockquote>
<table>
<tr>
  <th> Map </th>
  <th> Shuffle/Partition </th>
  <th> Sort </th>
</tr>
<tr>

<td>

<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="center">Value 1</th>
<th align="left">Value 2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left"></td></td>
<td align="center"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><td></td>
<td align="center"></td>
<td align="left"></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">Key</th>
<th align="left">Value 2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Apple, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Apple,<strong>‘2020-10-5’</strong></td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Apple, <strong>‘2020-10-2’</strong></td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Apple, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Banana, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Banana, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Orange, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Orange, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
</tbody></table>
</td>
<td>

<table>
<thead>
<tr>
<th align="center">Key</th>
<th align="left">Value 2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Apple, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Apple, <strong>‘2020-10-2’</strong></td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Apple, <strong>‘2020-10-5’</strong></td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Apple, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Banana, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Banana, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Orange, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Orange, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center"></td></td>
<td align="left"></td>
</tr>
<tr>
<td align="center"></tr></td>
<td align="left"></td>
</tr>
</tbody></table>
</table>

<p><strong>NATURAL JOIN (⋈)</strong></p>
<p>There are three approaches:</p>
<ul>
<li><code>Reduce-side Join</code></li>
<li><code>Map-side Join</code></li>
<li><code>In memory Join</code></li>
</ul>
<p><strong>Reduce-side Join</strong></p>
<p>When a join is performed by the reducer, it is called as reduce-side join. For this method, the main thing done on the map stage is put a <code>tag</code> to the files. For example:</p>
<img src="/2020/11/09/BigData-3/reduce_side_join_example.png" class="" title="Example">

<p>Another illustration is taken from Guru99.</p>
<img src="/2020/11/09/BigData-3/reduce_side_join_from_guru99.png" class="" title="Example">

<p>In general, this method will work for 1-to-1 join. However, for 1-to-many or many-to-many, it might have a potential problem with memory. To solve the problem, there are two keys:</p>
<ul>
<li><code>Save the data into memory, if the memory is not enough, write to disk</code></li>
<li><code>Value-to-Key conversion</code></li>
</ul>
<p><strong>Map-side Join</strong></p>
<p>No reducer is required. </p>
<blockquote>
<p>Suppose we have two datasets that are both sorted by the join key. We can perform a join by scanning through both datasets simultaneously. This is known as a merge join in the database community. We can parallelize this by partitioning and sorting both datasets in the same way. </p>
</blockquote>
<p><strong>In memory Join</strong></p>
<p>Load one dataset into memory, stream over other dataset.</p>
<p>In general, <code>in-memory join</code> &gt; <code>map-side join</code> &gt; <code>reduce-side join</code>.</p>
<p>Best choice: when the data is smaller than main memory, prefers in-memory join. If in-memory join is not possible, yet, the file is partitioned according to the key, uses map-side join. Otherwise, use reduce-side join. </p>
<br/>
<br/>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://www.guru99.com/relational-algebra-dbms.html" target="_blank" rel="noopener">Relational Algebra in DBMS: Operations with Examples</a>  </li>
<li><a href="https://www.guru99.com/introduction-to-counters-joins-in-map-reduce.html" target="_blank" rel="noopener">Hadoop MapReduce Join &amp; Counter with Example</a>  </li>
<li><a href="https://blog.csdn.net/sofuzi/article/details/81265402" target="_blank" rel="noopener">MapReduce：实现join的几种方法</a>  </li>
<li><a href="http://shzhangji.com/cnblogs/2015/01/13/understand-reduce-side-join/" target="_blank" rel="noopener">深入理解 Reduce-side Join</a></li>
</ul>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2020-11-09</span><i class="fa fa-tag"></i><a class="tag" href="/tags/Big-Data/" title="Big Data">Big Data </a><span class="leancloud_visitors"></span></div></div></div></div><div class="share"><div class="evernote"><a class="fa fa-bookmark" href="" onclick="javascript:join_favorite()" ref="sidebar"></a></div><div class="weibo"><a class="fa fa-weibo" href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&amp;title=',e(d.title),'&amp;appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));"></a></div><div class="twitter"><a class="fa fa-twitter" href="http://twitter.com/home?status=,https://shimingwu.github.io/2020/11/09/BigData-3/,Shiming' target="_blank" rel="noopener"s Blog,BigData(3),;"></a></div></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2020/11/09/BigData-5/" title="BigData(5)">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2020/11/08/BigData-2/" title="BigData(2)">下一篇</a></li></ul></div><script src="/js/visitors.js"></script></div></div></div></div><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script><script src="/js/add-bookmark.js"></script><script src="/js/baidu-tongji.js"></script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/tororo.model.json"},"display":{"position":"left","width":200,"height":400,"hOffset":5,"vOffset":-38},"mobile":{"show":false,"scale":0.2},"react":{"opacityDefault":0.8,"opacityOnHover":0.2},"log":false});</script></body></html>