<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Shiming&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="寄言燕雀莫相啅， 自有云霄万里高。">
<meta property="og:type" content="website">
<meta property="og:title" content="Shiming&#39;s Blog">
<meta property="og:url" content="https://shimingwu.github.io/index.html">
<meta property="og:site_name" content="Shiming&#39;s Blog">
<meta property="og:description" content="寄言燕雀莫相啅， 自有云霄万里高。">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Shiming Wu">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Shiming&#39;s Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Shiming&#39;s Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://shimingwu.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-BigData-3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/09/BigData-3/" class="article-date">
  <time datetime="2020-11-09T14:24:09.000Z" itemprop="datePublished">2020-11-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/09/BigData-3/">BigData(3)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is revision note for NUS master study of CS5425 Big Data Systems for Data Science.</p>
<h2 id="Relational-Database"><a href="#Relational-Database" class="headerlink" title="Relational Database"></a>Relational Database</h2><p>Usually, Hadoop/MapReduce is used to support the OLAP.</p>
<h3 id="Relational-Algebra"><a href="#Relational-Algebra" class="headerlink" title="Relational Algebra"></a>Relational Algebra</h3><p>Considering the table <code>Employee</code>. All examples will use the table.</p>
<p><strong>Projection Π</strong></p>
<table>
<tr><th> Employee </th><th> Π NAME, AGE (Employee) </th></tr>
<tr><td>

<table>
<thead>
<tr>
<th align="left">ID</th>
<th align="center">NAME</th>
<th align="left">AGE</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="center">Mike</td>
<td align="left">12</td>
</tr>
<tr>
<td align="left">2</td>
<td align="center">Jane</td>
<td align="left">22</td>
</tr>
<tr>
<td align="left">3</td>
<td align="center">Vincent</td>
<td align="left">45</td>
</tr>
</tbody></table>
</td><td>

<table>
<thead>
<tr>
<th align="center">NAME</th>
<th align="left">AGE</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Mike</td>
<td align="left">12</td>
</tr>
<tr>
<td align="center">Jane</td>
<td align="left">22</td>
</tr>
<tr>
<td align="center">Vincent</td>
<td align="left">45</td>
</tr>
</tbody></table>
</td></tr> </table>

<p>To perform projection, only mapper is used. The bottleneck is the streaming read speed of HDFS.</p>
<p><strong>Selection σ</strong></p>
<table>
<tr><th> Employee </th><th> σ ID = 1 (Employee) </th></tr>
<tr><td>

<table>
<thead>
<tr>
<th align="left">ID</th>
<th align="center">NAME</th>
<th align="left">AGE</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="center">Mike</td>
<td align="left">12</td>
</tr>
<tr>
<td align="left">2</td>
<td align="center">Jane</td>
<td align="left">22</td>
</tr>
<tr>
<td align="left">3</td>
<td align="center">Vincent</td>
<td align="left">45</td>
</tr>
</tbody></table>
</td><td>

<table>
<thead>
<tr>
<th align="left">ID</th>
<th align="center">NAME</th>
<th align="left">AGE</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="center">Mike</td>
<td align="left">12</td>
</tr>
</tbody></table>
</td></tr> </table>

<p>To perform projection, only mapper is used. The bottleneck is the streaming read speed of HDFS. Selection is very similar to Projection in general.</p>
<p><strong>Group By (Aggregation)</strong></p>
<p>This can be done via mapper + reducer. In addition, combiner can be used to optimize the performance. </p>
<p><strong>Order By</strong></p>
<p>There are two sort problems here: Sort by <strong>Key</strong> and Sort by <strong>Value</strong>.</p>
<p>In terms of sort by key, MapReduce (Hadoop) guarantees the order of keys are sorted before sending to the reducers. If a tuple only has a single column, for example, {‘Apple’, 1}, then the sort is very simple.</p>
<p>However, what if there are multiple columns exist for a tuple, for example, {‘Apple’, ‘2020-10-2’, 1}. If we want to sort by the fruit name, followed by the sort of date, there are 2 main approaches:</p>
<ul>
<li><code>Sort inside Reducer (BAD)</code></li>
<li><code>Value-to-Key (BETTER)</code></li>
</ul>
<blockquote>
<p>For the first approach, it involves having the reducer buffer all of the values for a given key and do an in-reducer sort. Since the reducer will be receiving all values for a given key, this approach could possibly cause the reducer to run out of memory. </p>
</blockquote>
<table>
<tr>
  <th> Map </th>
  <th> Shuffle and Sort (by the key) </th>
  <th> Reduce </th>
</tr>
<tr>

<td>

<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="center">Value 1</th>
<th align="left">Value 2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left"></td></td>
<td align="center"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><td></td>
<td align="center"></td>
<td align="left"></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="center">Values under the key</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Apple</td>
<td align="center">(‘2020-10-2’, 10)<br/> <strong>(‘2020-10-5’, 20)</strong><br/> <strong>(‘2020-10-2’, 10)</strong><br/> (‘2020-10-5’, 20)</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">(‘2020-10-5’, 20)<br/> (‘2020-10-5’, 20)</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">(‘2020-10-2’, 10)<br/> (‘2020-10-2’, 10)</td>
</tr>
</tbody></table>
</td>
<td>

<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="center">Values under the key</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Apple</td>
<td align="center">(‘2020-10-2’, 10)<br/>  <strong>(‘2020-10-2’, 10)</strong><br/> <strong>(‘2020-10-5’, 20)</strong><br/>(‘2020-10-5’, 20)</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">(‘2020-10-5’, 20)<br/> (‘2020-10-5’, 20)</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">(‘2020-10-2’, 10)<br/> (‘2020-10-2’, 10)</td>
</tr>
<tr>
<td align="left"></td></td>
<td align="center"></td>
</tr>
<tr>
<td align="left"></tr></td>
<td align="center"></td>
</tr>
</tbody></table>
</table>

<blockquote>
<p>The second approach involves creating a composite key by adding a part of, or the entire value to the natural key to achieve your sorting objectives. </p>
</blockquote>
<table>
<tr>
  <th> Map </th>
  <th> Shuffle/Partition </th>
  <th> Sort </th>
</tr>
<tr>

<td>

<table>
<thead>
<tr>
<th align="left">Key</th>
<th align="center">Value 1</th>
<th align="left">Value 2</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Banana</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left">Orange</td>
<td align="center">‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="left">Apple</td>
<td align="center">‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="left"></td></td>
<td align="center"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><td></td>
<td align="center"></td>
<td align="left"></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="center">Key</th>
<th align="left">Value 2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Apple, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Apple,<strong>‘2020-10-5’</strong></td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Apple, <strong>‘2020-10-2’</strong></td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Apple, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Banana, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Banana, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Orange, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Orange, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
</tbody></table>
</td>
<td>

<table>
<thead>
<tr>
<th align="center">Key</th>
<th align="left">Value 2</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Apple, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Apple, <strong>‘2020-10-2’</strong></td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Apple, <strong>‘2020-10-5’</strong></td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Apple, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Banana, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Banana, ‘2020-10-5’</td>
<td align="left">20</td>
</tr>
<tr>
<td align="center">Orange, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center">Orange, ‘2020-10-2’</td>
<td align="left">10</td>
</tr>
<tr>
<td align="center"></td></td>
<td align="left"></td>
</tr>
<tr>
<td align="center"></tr></td>
<td align="left"></td>
</tr>
</tbody></table>
</table>

<p><strong>NATURAL JOIN (⋈)</strong></p>
<p>There are three approaches:</p>
<ul>
<li><code>Reduce-side Join</code></li>
<li><code>Map-side Join</code></li>
<li><code>In memory Join</code></li>
</ul>
<p><strong>Reduce-side Join</strong></p>
<p>When a join is performed by the reducer, it is called as reduce-side join. For this method, the main thing done on the map stage is put a <code>tag</code> to the files. For example:</p>
<img src="/2020/11/09/BigData-3/reduce_side_join_example.png" class="" title="Example">

<p>Another illustration is taken from Guru99.</p>
<img src="/2020/11/09/BigData-3/reduce_side_join_from_guru99.png" class="" title="Example">

<p>In general, this method will work for 1-to-1 join. However, for 1-to-many or many-to-many, it might have a potential problem with memory. To solve the problem, there are two keys:</p>
<ul>
<li><code>Save the data into memory, if the memory is not enough, write to disk</code></li>
<li><code>Value-to-Key conversion</code></li>
</ul>
<p><strong>Map-side Join</strong></p>
<p>No reducer is required. </p>
<blockquote>
<p>Suppose we have two datasets that are both sorted by the join key. We can perform a join by scanning through both datasets simultaneously. This is known as a merge join in the database community. We can parallelize this by partitioning and sorting both datasets in the same way. </p>
</blockquote>
<p><strong>In memory Join</strong></p>
<p>Load one dataset into memory, stream over other dataset.</p>
<p>In general, <code>in-memory join</code> &gt; <code>map-side join</code> &gt; <code>reduce-side join</code>.</p>
<p>Best choice: when the data is smaller than main memory, prefers in-memory join. If in-memory join is not possible, yet, the file is partitioned according to the key, uses map-side join. Otherwise, use reduce-side join. </p>
<br/>
<br/>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://www.guru99.com/relational-algebra-dbms.html" target="_blank" rel="noopener">Relational Algebra in DBMS: Operations with Examples</a>  </li>
<li><a href="https://www.guru99.com/introduction-to-counters-joins-in-map-reduce.html" target="_blank" rel="noopener">Hadoop MapReduce Join &amp; Counter with Example</a>  </li>
<li><a href="https://blog.csdn.net/sofuzi/article/details/81265402" target="_blank" rel="noopener">MapReduce：实现join的几种方法</a>  </li>
<li><a href="http://shzhangji.com/cnblogs/2015/01/13/understand-reduce-side-join/" target="_blank" rel="noopener">深入理解 Reduce-side Join</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/11/09/BigData-3/" data-id="ckha7v7if000m0qr7b8qe8ebg" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Big-Data/" rel="tag">Big Data</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-BigData-2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/08/BigData-2/" class="article-date">
  <time datetime="2020-11-08T22:10:26.000Z" itemprop="datePublished">2020-11-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/08/BigData-2/">BigData(2)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is revision note for NUS master study of CS5425 Big Data Systems for Data Science.</p>
<h2 id="Challenges"><a href="#Challenges" class="headerlink" title="Challenges"></a>Challenges</h2><p>In order to process the huge amount of data, parallelization is required. However, there are multiple challenge faced is the execution of the parallelization. For example, it is difficult to manage the communication between workers. One typical example can be the detection of a failed worker. It is hard to determine if a works is slow (takes longer to response) or it is failed. Moreover, there will have conflicts for resources access for different tasks. Even if there are multiple solutions like lock, conditional variables, etc, some other problems still exist.</p>
<p>It is a factor that there are many solutions provided, whilst these solutions do not fit as a big data solution. For example, programmers still need to handle the locks and take care of some performance optimizations. </p>
<h2 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h2><p>With the challenges, MapReduce was proposed as <strong>one of the solutions</strong> (a programming framework) to solve the massive data problem. Google has implemented MapReduce in C++, Java and Python.</p>
<img src="/2020/11/08/BigData-2/MapReduce.png" class="" title="illusion of MapReduce">

<p>Divide and conquer is the concept working behind. The tasks are distributed into different mappers and the tasks will be executed <strong>in parallel</strong>. However, the shuffle and sort becomes the bottleneck of the performance of the system because the moving of data is very costly. Last, the results will be sent to reducer for the aggregation, and the number of reducers can be another problem.</p>
<p>Besides the three steps mentioned:</p>
<ul>
<li><code>Map</code></li>
<li><code>Shuffle and sort</code></li>
<li><code>Reduce</code></li>
</ul>
<p>Two more steps can be done: <code>combine</code> and <code>partition</code>. These two steps are serving as an optimization.</p>
<ul>
<li><p><code>Combine</code>: The combine function will be done in <strong>memory</strong>. This is to reduce the amount of data to be transferred via network. For example, if we have multiple key-value pairs: {a:1}, {b:2}, {a:3}, {c:4}. There are total 4 pairs will be sent to the next step from current worker. A combine function can helps to combine the results to {a:4}, {b:2}, {c:4} if the method of combining is addition. The number of pairs to be sent will be decreased from 4 to 3. The combine function can happen at different levels after a mapper task is completed.</p>
</li>
<li><p><code>Partition</code>: The partition function influence how the shuffle and sort works. A partition function can divide/split the mapper results and based on key, value or the number of reducers to distribute the results. </p>
</li>
</ul>
<h2 id="Hadoop"><a href="#Hadoop" class="headerlink" title="Hadoop"></a>Hadoop</h2><p>As is known, MapReduce is a programming model and an associated implementation. Hadoop is an open-sourced version of MapReduce implementation in Java. </p>
<p>There are two important parts in Hadoop:</p>
<ul>
<li><code>HDFS</code></li>
<li><code>MapReduce</code></li>
</ul>
<p><code>HDFS</code> is a distributed file system and it is an open-sourced version of <code>GFS</code> (Google File System). GFS is the file system invested and used by Google to support a huge data processing and it has many advantages. As an open-sourced version (or clone) of the GFS, HDFS does not follow certain design decisions made by GFS. </p>
<p>The architecture of HDFS is shown below.</p>
<img src="/2020/11/08/BigData-2/HDFSArchitecture.png" class="" title="HDFS Architecture">

<blockquote>
<p>HDFS has a master/slave architecture. An HDFS cluster consists of a single NameNode, a master server that manages the file system namespace and regulates access to files by clients. In addition, there are a number of DataNodes, usually one per node in the cluster, which manage storage attached to the nodes that they run on. HDFS exposes a file system namespace and allows user data to be stored in files. Internally, a file is split into one or more blocks and these blocks are stored in a set of DataNodes. The NameNode executes file system namespace operations like opening, closing, and renaming files and directories. It also determines the mapping of blocks to DataNodes. The DataNodes are responsible for serving read and write requests from the file system’s clients. The DataNodes also perform block creation, deletion, and replication upon instruction from the NameNode.</p>
</blockquote>
<p>Notice that HDFS is still a <strong>master-slave architecture</strong>.</p>
<h2 id="Basic-Algorithm-design-with-MapReduce"><a href="#Basic-Algorithm-design-with-MapReduce" class="headerlink" title="Basic Algorithm design with MapReduce"></a>Basic Algorithm design with MapReduce</h2><p>As MapReduce provides a high abstraction and many implementation details are hidden like we do not know where the mappers/reducers are running, when a particular mapper/reducers starts or finishes, there are only 4 places to implement an algorithm:</p>
<ul>
<li><code>map</code></li>
<li><code>reduce</code></li>
<li><code>combiner</code></li>
<li><code>partitioner</code></li>
</ul>
<p>Some concerns should be taken into considerations. For example, for partial results, we might not want to emit partial results immediately in certain cases, as this might result in more traffic over network and slow down the processing. Three things are important for the performance for an algorithm design for MapReduce:</p>
<ul>
<li><code>Linear scalability</code></li>
<li><code>Minimize I/O for both hard disk and network</code></li>
<li><code>Memory</code></li>
</ul>
<h3 id="Linear-Scalability"><a href="#Linear-Scalability" class="headerlink" title="Linear Scalability"></a>Linear Scalability</h3><p>With the increase of the data size, the cost of communication will increase. As the <strong>input to every reducer is guaranteed to be sorted</strong> in MapReducer, there is a process to sort and transfer the results provided by mapper to the reducers, which is known as shuffle and it is a synchronization operation. The synchronous operation will make a significant impact on the overall performance. </p>
<p>To avoid this, there are two main methods:</p>
<ul>
<li><p><code>Local aggregation</code></p>
<p>A result can be aggregated during the map task. This is also known as <code>in-mapper combing</code> pattern.</p>
</li>
<li><p><code>Combiner</code></p>
<p>Use combiner to reduce the network traffic</p>
</li>
</ul>
<p>For <code>Local aggregation</code>, it is usually faster than actual <code>combiner</code> because it does not need to spill to the disk. However, a higher memory is requested. Moreover, implementation complexity might increase.</p>
<br/>
<br/>

<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul>
<li><a href="https://cloud.tencent.com/developer/article/1030329" target="_blank" rel="noopener">简单解释 MapReduce 算法</a>  </li>
<li><a href="https://hadoop.apache.org/docs/r1.2.1/hdfs_design.html" target="_blank" rel="noopener">HDFS Architecture Guide</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/11/08/BigData-2/" data-id="ckha7v7ie000k0qr7g8aebsjk" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Big-Data/" rel="tag">Big Data</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-BigData-1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/08/BigData-1/" class="article-date">
  <time datetime="2020-11-08T16:50:13.000Z" itemprop="datePublished">2020-11-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/08/BigData-1/">BigData(1)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>This is revision note for NUS master study of CS5425 Big Data Systems for Data Science.</p>
<h2 id="5V-for-big-data"><a href="#5V-for-big-data" class="headerlink" title="5V for big data"></a>5V for big data</h2><ul>
<li><code>Volume</code>: The size/scale of data</li>
<li><code>Velocity</code>: The speed of input of data (like data streaming)</li>
<li><code>Variety</code>: The different structures of data. For example, images, articles…</li>
<li><code>Veracity</code>: The quality of data. </li>
<li><code>Value</code>: The value brought by the data</li>
</ul>
<p>Nowadays, the frequent network activities result in a huge amount of data (Volume). To process these data, big data technology is required. Furthermore, the speed to process data is important (Velocity). For example, if we cannot analyze the data obtained within certain period of time, the value of data will be lost (Value), like detecting the system error in transport system of a city. Besides, there are multiple types of data are generated (Variety). Lastly, even if the data can be processed in a huge volume fast, the quality of both data and results should be taken care of (Veracity).</p>
<h2 id="Infrastructure-of-big-data"><a href="#Infrastructure-of-big-data" class="headerlink" title="Infrastructure of big data"></a>Infrastructure of big data</h2><ul>
<li><code>Cloud Computing</code></li>
<li><code>Data Center</code></li>
</ul>
<p>Cloud computing serves as an infrastructure to support the big data processing and calculation. There are three main serves provided by the cloud computing:</p>
<ul>
<li><code>IaaS</code>: Infrastructure as a Service. With this, the operation cost can be saved.</li>
<li><code>PaaS</code>: Platform as a Service. Users can configure certain platforms like databases.</li>
<li><code>SaaS</code>: Software as a Service. Users can directly consume the software like Gmail.</li>
</ul>
<p>With these, everything can be provided as a service and it helps to save cost, provide ‘infintie’ calculating/storage capacity to users and users  can utilize these on demand. At the same, Cloud Computing also contributes a lot in terms of data generating. Thus, it is a data provider, at the same time, also a solution provider.</p>
<p>Data center serves as a key infrastructure of cloud computing. A data center mainly has three blocks:</p>
<ul>
<li><code>blade server</code>: refer to a normal server</li>
<li><code>rack</code>: a rack consists of dozens of servers</li>
<li><code>data center</code>: a data center consists of many racks</li>
</ul>
<p>The transfer of data is expensive especially when a data needs to be sent across the network.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/11/08/BigData-1/" data-id="ckha7v7ic000i0qr7hbz23t0n" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Big-Data/" rel="tag">Big Data</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-LeetCode-Largest-Number" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/26/LeetCode-Largest-Number/" class="article-date">
  <time datetime="2020-09-26T12:29:08.000Z" itemprop="datePublished">2020-09-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/26/LeetCode-Largest-Number/">LeetCode Largest Number</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Question"><a href="#Question" class="headerlink" title="Question"></a><a href="https://leetcode.com/problems/largest-number/submissions/" target="_blank" rel="noopener">Question</a></h2><p>Given a list of non negative integers, arrange them such that they form the largest number.</p>
<p><b>Example 1:</b></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [10,2]</span><br><span class="line">Output: &quot;210&quot;</span><br></pre></td></tr></table></figure>
<p><b>Example 2:</b></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [3,30,34,5,9]</span><br><span class="line">Output: &quot;9534330&quot;</span><br></pre></td></tr></table></figure>

<h2 id="Solution-1"><a href="#Solution-1" class="headerlink" title="Solution 1"></a>Solution 1</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">largestNumber</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> numStr []<span class="keyword">string</span>;</span><br><span class="line">     <span class="keyword">for</span> i:=<span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;            </span><br><span class="line">         numStr = <span class="built_in">append</span>(numStr, strconv.Itoa(nums[i]))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> result []<span class="keyword">string</span>;</span><br><span class="line">    result = quickSort(numStr, <span class="number">0</span>, <span class="built_in">len</span>(numStr)<span class="number">-1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> str <span class="keyword">string</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i:=<span class="built_in">len</span>(result)<span class="number">-1</span>; i &gt;=<span class="number">0</span>; i--&#123;</span><br><span class="line">        str += result[i]</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> str[<span class="number">0</span>] == <span class="string">'0'</span> &#123;</span><br><span class="line">        str = <span class="string">"0"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quickSort</span><span class="params">(nums []<span class="keyword">string</span>, left <span class="keyword">int</span>, right <span class="keyword">int</span>)</span> []<span class="title">string</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> left &gt; right &#123;</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    i := left</span><br><span class="line">    j := right</span><br><span class="line">    </span><br><span class="line">    pivot := nums[left]</span><br><span class="line">    <span class="keyword">for</span> i != j &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> compare(nums[j], pivot) &amp;&amp; i &lt; j &#123;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> compare(pivot, nums[i]) &amp;&amp; i &lt; j &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> i &lt; j &#123;</span><br><span class="line">            temp := nums[i];</span><br><span class="line">            nums[i] = nums[j]</span><br><span class="line">            nums[j] = temp</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    nums[left] = nums[i];</span><br><span class="line">    nums[i] = pivot;</span><br><span class="line">    </span><br><span class="line">    quickSort(nums, left, i<span class="number">-1</span>);</span><br><span class="line">    quickSort(nums, i+<span class="number">1</span>, right);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">compare</span><span class="params">(num1 <span class="keyword">string</span>, num2 <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> num1 == num2 &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    len1 := <span class="built_in">len</span>(num1)</span><br><span class="line">    len2 := <span class="built_in">len</span>(num2)</span><br><span class="line">    </span><br><span class="line">    maxLen := len1*<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> len2 &gt; len1 &#123;</span><br><span class="line">        maxLen = len2*<span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> ; i &lt; maxLen; i++ &#123;</span><br><span class="line">        num1Digit := num1[i % len1]</span><br><span class="line">        num2Digit := num2[i % len2]</span><br><span class="line">        <span class="keyword">if</span> num1Digit &gt; num2Digit &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> num1Digit &lt; num2Digit &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h2 id="Solution-2"><a href="#Solution-2" class="headerlink" title="Solution 2"></a>Solution 2</h2><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pow10 = [<span class="number">10</span>]<span class="keyword">int</span> &#123;<span class="number">1</span>, <span class="number">10</span>, <span class="number">100</span>, <span class="number">1000</span>, <span class="number">10000</span>, <span class="number">100000</span>, <span class="number">1000000</span>, <span class="number">10000000</span>, <span class="number">100000000</span>, <span class="number">1000000000</span>&#125;</span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">largestNumber</span><span class="params">(nums []<span class="keyword">int</span>)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> result []<span class="keyword">int</span>;</span><br><span class="line">    result = quickSort(nums, <span class="number">0</span>, <span class="built_in">len</span>(nums)<span class="number">-1</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> str <span class="keyword">string</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i:=<span class="built_in">len</span>(result)<span class="number">-1</span>; i &gt;=<span class="number">0</span>; i--&#123;</span><br><span class="line">        str += strconv.Itoa(result[i])</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> str[<span class="number">0</span>] == <span class="string">'0'</span> &#123;</span><br><span class="line">        str = <span class="string">"0"</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> str</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">quickSort</span><span class="params">(nums []<span class="keyword">int</span>, left <span class="keyword">int</span>, right <span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> left &gt; right &#123;</span><br><span class="line">        <span class="keyword">return</span> nums</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    i := left</span><br><span class="line">    j := right</span><br><span class="line">    </span><br><span class="line">    pivot := nums[left]</span><br><span class="line">    <span class="keyword">for</span> i != j &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> compare(nums[j], pivot) &amp;&amp; i &lt; j &#123;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> compare(pivot, nums[i]) &amp;&amp; i &lt; j &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> i &lt; j &#123;</span><br><span class="line">            temp := nums[i];</span><br><span class="line">            nums[i] = nums[j]</span><br><span class="line">            nums[j] = temp</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    nums[left] = nums[i];</span><br><span class="line">    nums[i] = pivot;</span><br><span class="line">    </span><br><span class="line">    quickSort(nums, left, i<span class="number">-1</span>);</span><br><span class="line">    quickSort(nums, i+<span class="number">1</span>, right);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> nums</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">compare</span><span class="params">(num1 <span class="keyword">int</span>, num2 <span class="keyword">int</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> num1 == num2 &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    len1 := <span class="built_in">len</span>(strconv.Itoa(num1))</span><br><span class="line">    len2 := <span class="built_in">len</span>(strconv.Itoa(num2))</span><br><span class="line">    </span><br><span class="line">    maxLen := len1*<span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> len2 &gt; len1 &#123;</span><br><span class="line">        maxLen = len2*<span class="number">2</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span> ; i &lt; maxLen; i++ &#123;</span><br><span class="line">        </span><br><span class="line">        num1Digit := num1 / pow10[len1 - (i % len1 + <span class="number">1</span>)] % <span class="number">10</span></span><br><span class="line">        num2Digit := num2 / pow10[len2 - (i % len2 + <span class="number">1</span>)] % <span class="number">10</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> num1Digit &gt; num2Digit &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> num1Digit &lt; num2Digit &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/09/26/LeetCode-Largest-Number/" data-id="ckha7v7ig000o0qr791tv6azc" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Algorithm/" rel="tag">Algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-LeetCode-Majority-Element-II" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/09/22/LeetCode-Majority-Element-II/" class="article-date">
  <time datetime="2020-09-22T22:26:41.000Z" itemprop="datePublished">2020-09-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/09/22/LeetCode-Majority-Element-II/">LeetCode(229) Majority Element II</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Question"><a href="#Question" class="headerlink" title="Question"></a><a href="https://leetcode.com/problems/majority-element-ii/" target="_blank" rel="noopener">Question</a></h2><p>Given an integer array of size n, find all elements that appear more than ⌊ n/3 ⌋ times.</p>
<p>Note: The algorithm should run in linear time and in O(1) space.</p>
<p><b>Example 1:</b></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [3,2,3]</span><br><span class="line">Output: [3]</span><br></pre></td></tr></table></figure>
<p><b>Example 2:</b></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [1,1,1,3,3,2,2,2]</span><br><span class="line">Output: [1,2]</span><br></pre></td></tr></table></figure>

<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>The solution for this problem relies on one observation, which is that, for any array, <strong>there will have at most 2 elements that occurs more than ⌊ n/3 ⌋ times.</strong> After knowing this, we shall be able to achieve the O(1) space as we only rely on 4 variables here.</p>
<p>Fisrtly, we require 2 sets of (element, count) as we would like to find the top 2 majority element.</p>
<p>Secondly, it is known that, if an element is a majority element, the count CANNOT be 0.<br>For example, if we have an array of size 10 <code>[1, 1, 1, 1, 2, 3, 4, 5, 6, 7]</code>, to be a majority element, it must occurs 4 times. We will have, for first pair of (element, count), we can have (1, 4), and second element it will be used to allocate another 1/3 of elements. In this case, the element 1 will be always having more than 0 counts.</p>
<p>If there are 2 majority elements, the logic still apply. We will have 2 paris to allocate the count, only left with at most 3 elements to be reduced. Therefore, both counts won’t be 0, which implies that the candidates will not be replaced.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">majorityElement</span><span class="params">(nums []<span class="keyword">int</span>)</span> []<span class="title">int</span></span> &#123;</span><br><span class="line">    </span><br><span class="line">     <span class="keyword">var</span> results []<span class="keyword">int</span>;</span><br><span class="line">    <span class="keyword">var</span> count1 <span class="keyword">int</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">var</span> count2 <span class="keyword">int</span> = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(nums) == <span class="number">0</span> || nums == <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> results</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> candidate1 <span class="keyword">int</span> = nums[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">var</span> candidate2 <span class="keyword">int</span> = nums[<span class="number">0</span>];</span><br><span class="line">  </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> candidate1 == nums[i] &#123;</span><br><span class="line">            count1++</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> candidate2 == nums[i] &#123;</span><br><span class="line">            count2++</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> count1 == <span class="number">0</span> &#123;</span><br><span class="line">            candidate1 = nums[i]</span><br><span class="line">            count1++</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> count2 == <span class="number">0</span> &#123;</span><br><span class="line">            candidate2 = nums[i]</span><br><span class="line">            count2++</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            count1--</span><br><span class="line">            count2--</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    count1 = <span class="number">0</span></span><br><span class="line">    count2 = <span class="number">0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i:=<span class="number">0</span>; i &lt; <span class="built_in">len</span>(nums); i++ &#123;</span><br><span class="line">        <span class="keyword">if</span> nums[i] == candidate1 &#123;</span><br><span class="line">            count1++</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> nums[i] == candidate2 &#123;</span><br><span class="line">            count2++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    limit := <span class="built_in">len</span>(nums)/<span class="number">3</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> limit != <span class="number">0</span> &#123;</span><br><span class="line">        limit += <span class="number">1</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> count1 &gt;= limit &#123;</span><br><span class="line">        results = <span class="built_in">append</span>(results, candidate1)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> count2 &gt;= limit &amp;&amp; candidate1 != candidate2 &#123;</span><br><span class="line">        results = <span class="built_in">append</span>(results, candidate2)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> results</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/09/22/LeetCode-Majority-Element-II/" data-id="ckha7v7ii000r0qr7b3lyc7ak" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Algorithm/" rel="tag">Algorithm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-关于Webpack" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/21/%E5%85%B3%E4%BA%8EWebpack/" class="article-date">
  <time datetime="2020-07-21T21:00:54.000Z" itemprop="datePublished">2020-07-21</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/21/%E5%85%B3%E4%BA%8EWebpack/">关于Webpack</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <br/>
<br/>
谁能想到两年前做的东西……两年后要重温一遍呢。并且随着合作过的程序员越来越多，有意识到蛮多同事（甚至是专职写前端的程序员）往往根本没有机会去设置webpack，对这个打包工具的概念一知半解，就干脆把一些简单的概念总结一下（当然官网上写的非常好，个人很推荐感兴趣的同学直接阅读官网），并且提供一些小练习来加深理解。

<h2 id="1-什么是Webpack"><a href="#1-什么是Webpack" class="headerlink" title="1. 什么是Webpack"></a>1. 什么是Webpack</h2><p>简单来说，webpack是一个<u>静态模块打包工具</u>。它的主要概念就是将多个JavaScript，css，image等不同的任何类型的文件捆绑在一起。它会分析这些文件之间的依赖关系，比如什么文件import（导入）了什么文件，并且在内部生成一个dependency graph（依赖图），从而生成一个或者多个bundle（捆绑）文件。<br>但webpack又不仅仅只是一个捆绑工具，它同时也可以帮忙处理优化文件，如manifest；也可以使用loader去进行一些转义工作，使得不同类型的文件可以被捆绑；还可以使用plugin去进行environment variable injection等操作。但所有这些处理的最终目的都是为了将不同的文件处理成适合的浏览器可以接受的格式并且打包。</p>
<br/>
<br/>

<h2 id="2-Webpack如何工作"><a href="#2-Webpack如何工作" class="headerlink" title="2. Webpack如何工作"></a>2. Webpack如何工作</h2><p>我们知道webpack会将多个文件进行分析并且打包，那么它是如何做到的呢？首先，webpack需要一个entry point（入口起点），没有这个起点，webpack就无法构建内部依赖图。这可以通过配置 <code>entry</code> 选项来指定：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/app.js'</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>当然，我们也可以指定多个起点来告诉webpack我们需要多个<b>独立的</b>依赖图，这种情况往往应用于多页面应用，每次从服务器获取新的HTML页面的时候，页面就会重新加载资源，不同的页面可能需要不同的打包文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: &#123;</span><br><span class="line">        main: <span class="string">'./src/main/app.js'</span>,</span><br><span class="line">        payment: <span class="string">'./src/paymeng/app.js'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>再说明完了webpack如何<b>找到入口开始分析</b>后，我们通过可以配置 <code>output</code> （输出）选项来指定webpack我们希望它生成的文件名:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    output: &#123;</span><br><span class="line">        filename: <span class="string">'bundle.js'</span>,</span><br><span class="line">        path: __dirname + <span class="string">'/dist'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>根据以上的配置，webpack将会把文件打包并命名成 <code>bundle.js</code> 然后写入 <code>./dist</code> 目录。</p>
<blockquote>
<p>即使可以存在多个 <code>entry</code> 起点，但只能指定一个 <code>output</code> 配置。</p>
</blockquote>
<p>在了解了webpack如何<b>开始</b>以及<b>结束</b>了之后，我们可以开始更多的了解一下它的中间流程是怎么样的了。首先让我们理解一下两个概念：</p>
<ul>
<li><b>Loader</b>：Loader用于对模块的代码进行转换。</li>
<li><b>Plugin</b>：Plugin用于解决所有loader无法解决的问题。<br/>

</li>
</ul>
<p>打个比方，在使用React的时候，我们常常遇到一些需要对某些组件进行CSS的调整，这种情况下，我们该如何链接该JS文件与CSS文件呢？我们可以使用“css-loader”来解决：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123; <span class="attr">test</span>: <span class="regexp">/\.css$/</span>, <span class="attr">use</span>: <span class="string">'css-loader'</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>这个情况下，webpack就会知道，<b>使用 <code>css-loader</code> 来加载所有 <code>.css</code> 文件</b>。</p>
<blockquote>
<p>loader的使用有三种方式：通过配置<code>webpack.config.js</code>，通过在<code>import</code>语句中显式指定<code>loader</code>又或者在<code>shell</code>命令中指定。但通常我们会选择使用配置。</p>
</blockquote>
<p>另外，Webpack的loader都是per-file based的。即所有的 <code>.css</code> 文件都会被 <code>css-loader</code> 转换。另外我们还可以指定<b>多个loader</b>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="built_in">module</span>: &#123;</span><br><span class="line">    rules: [</span><br><span class="line">      &#123;</span><br><span class="line">        test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">'style-loader'</span> &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            loader: <span class="string">'css-loader'</span>,</span><br><span class="line">            options: &#123;</span><br><span class="line">              modules: <span class="literal">true</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123; <span class="attr">loader</span>: <span class="string">'sass-loader'</span> &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>以上为官方的例子，我们可以理解为，<b>以下至上</b>，所有的 <code>.css</code> 文件都会首先被 <code>sass-loader</code> 转换，接着被 <code>css-loader</code> 转换，最后被 <code>style-loader</code> 转换。</p>
<p>与 <code>loader</code> 相反， <code>plugin</code> 是对<b>连接生成的文件</b>进行处理。即它会全局式地对所有已经被 <code>loader</code> 处理完的文件再次进行优化。</p>
<br/>
<br/>

<h2 id="3-练习：从零开始使用webpack去设置React应用"><a href="#3-练习：从零开始使用webpack去设置React应用" class="headerlink" title="3. 练习：从零开始使用webpack去设置React应用"></a>3. 练习：从零开始使用webpack去设置React应用</h2><p>练习的时候可以参考这个代码来看是否哪里设置错误：<a href="https://github.com/shimingwu/webpack-demo-tutorial" target="_blank" rel="noopener">https://github.com/shimingwu/webpack-demo-tutorial</a></p>
<p>首先，创建一个本地文件夹 <code>webpack-demo</code>，使用npm进行管理，生成 <code>package.json</code> 来进行项目包的依赖管理。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br></pre></td></tr></table></figure>
<p>生成的文件如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"webpack-demo"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"shiming"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>安装webpack。当然通常我们也需要安装 <code>webpack-dev-server</code> 和 <code>webpack-cli</code> 用来跑本地的项目。另外安装在 <code>devDependecies</code> 的主要原因是我们并不需要把我们的项目发布，所以并没有生产环境下面需要的依赖项。即，如果放在 <code>Dependencies</code> 下面，当我们发布我们的项目的时候，依赖项会被一起打包加载。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev webpack webpack-dev-server webpack-cli</span><br></pre></td></tr></table></figure>
<p>安装完成后，我们应该看到 <code>package.json</code> 被更新了：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">"devDependecies": &#123;</span><br><span class="line">    "webpack": "^4.44.1",</span><br><span class="line">    "webpack-dev-server": "^3.11.0",</span><br><span class="line">    "webpack-cli": "^3.11.0"</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并且我们会看到 <code>node_modules</code> 文件夹。</p>
<img src="/2020/07/21/%E5%85%B3%E4%BA%8EWebpack/node_modules_generated.PNG" class="">

<p>安装React相关的依赖，并创建一个简单的React App。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save react react-dom</span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"webpack-demo"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"shiming"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^4.44.1"</span>,</span><br><span class="line">    <span class="attr">"webpack-cli"</span>: <span class="string">"^3.3.12"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-server"</span>: <span class="string">"^3.11.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"react"</span>: <span class="string">"^16.13.1"</span>,</span><br><span class="line">    <span class="attr">"react-dom"</span>: <span class="string">"^16.13.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建 <code>src</code> 文件夹，创建 <code>index.html</code>：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;utf-8&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;1024, initial-scale&#x3D;1.0, shrink-to-fit&#x3D;no, maximum-scale&#x3D;1.0, user-scalable&#x3D;no&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;theme-color&quot; content&#x3D;&quot;#000000&quot;&gt;</span><br><span class="line">    &lt;title&gt;Webpack Demo&lt;&#x2F;title&gt;</span><br><span class="line">  &lt;&#x2F;head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div id&#x3D;&quot;root&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">  &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>创建 <code>index.js</code>，该文件将作为webpack的entry：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> ReactDOM <span class="keyword">from</span> <span class="string">'react-dom'</span>;</span><br><span class="line"><span class="keyword">import</span> App <span class="keyword">from</span> <span class="string">'./App'</span>;</span><br><span class="line"></span><br><span class="line">ReactDOM.render(</span><br><span class="line">  &lt;App /&gt;,</span><br><span class="line">  <span class="built_in">document</span>.getElementById(<span class="string">'root'</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>创建 <code>App.js</code>, 这就是我们的React App文件:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;h1&gt;Hello World&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>

<p>创建 <code>App.css</code>，用来修饰我们的H1 tag。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.red</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>:red</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更新我们的 <code>App.js</code>，使其使用我们新创建的css文件：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> <span class="string">'./App.css'</span>; <span class="comment">//注意这里需要写完整名字，即写上.css，其他的js文件可以省略.js后缀，但是css文件不可以</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">App</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;h1 className=<span class="string">"red"</span>&gt;Hello World&lt;<span class="regexp">/h1&gt;</span></span><br><span class="line"><span class="regexp">  );</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default App;</span></span><br></pre></td></tr></table></figure>

<p>这时候我们已经写好了我们的sample app，更新 <code>package.json</code> 里面的 <code>scripts</code>， 写一条 <code>start</code> 命令用于跑 <code>webpack-dev-server</code>：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"name"</span>: <span class="string">"webpack-demo"</span>,</span><br><span class="line">  <span class="attr">"version"</span>: <span class="string">"1.0.0"</span>,</span><br><span class="line">  <span class="attr">"description"</span>: <span class="string">""</span>,</span><br><span class="line">  <span class="attr">"main"</span>: <span class="string">"index.js"</span>,</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"echo \"Error: no test specified\" &amp;&amp; exit 1"</span>,</span><br><span class="line">    <span class="attr">"start"</span>: <span class="string">"webpack-dev-server"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"author"</span>: <span class="string">"shiming"</span>,</span><br><span class="line">  <span class="attr">"license"</span>: <span class="string">"ISC"</span>,</span><br><span class="line">  <span class="attr">"devDependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"webpack"</span>: <span class="string">"^4.44.1"</span>,</span><br><span class="line">    <span class="attr">"webpack-cli"</span>: <span class="string">"^3.3.12"</span>,</span><br><span class="line">    <span class="attr">"webpack-dev-server"</span>: <span class="string">"^3.11.0"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"dependencies"</span>: &#123;</span><br><span class="line">    <span class="attr">"react"</span>: <span class="string">"^16.13.1"</span>,</span><br><span class="line">    <span class="attr">"react-dom"</span>: <span class="string">"^16.13.1"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动项目:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>
<p>我们会看到错误提示：</p>
<img src="/2020/07/21/%E5%85%B3%E4%BA%8EWebpack/error01.PNG" class="">

<p>这是因为React使用的是JSX，而webpack并不知道什么是JSX，于是我们要开始配置我们的webpack了。创建 <code>webpack.config.js</code>，这就是webpack的配置文件。我们已经了解过，我们需要一个入口以及一个输出：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>); <span class="comment">// node-js</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这样我们就可以让webpack帮忙把打包后的文件输出到 <code>/dist</code> 目录。</p>
<p>那么为了使webpack理解我们的 <code>js</code> 文件夹，我们需要依赖于某些 <code>loader</code> 。这里可以使用 <code>babel loader</code>，<code>babel</code> 则是一个通用的JavaScript编译器，Babel可以将某些版本的JavaScript代码转换为向后兼容的JavaScript语法。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev @babel/core babel-loader @babel/preset-env @babel/preset-react</span><br></pre></td></tr></table></figure>

<p>有了 <code>babel loader</code>，我们就可以开始配置webpack了。在 <code>module</code> 下面我们可以设置一个 <code>rule</code>，即：所有不在 <code>/node_modules</code> 目录下的 <code>.js</code> 文件都由 <code>babel-loader</code> 进行处理：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>); <span class="comment">// node-js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">"babel-loader"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这样一来又有一个问题，即 <code>babel-loader</code> 也不清楚我们希望使用什么样的转换。所以创建 <code>.babelrc</code> 文件进行设置。<code>.babelrc</code> 即 <code>babel</code> 的配置文件。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"presets"</span>: [<span class="string">"@babel/preset-env"</span>, <span class="string">"@babel/preset-react"</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在我们再跑一次 <code>start</code> 命令，我们会看到新的错误提示：</p>
<img src="/2020/07/21/%E5%85%B3%E4%BA%8EWebpack/error02.PNG" class="">

<p>这是因为webpack不知道该如何处理 <code>css</code> 文件，这里我们可以使用 <code>css-loader</code> 使得webpack知道如何处理 <code>css</code> 文件，使用 <code>style-loader</code> 使得webpack知道如何将 <code>css</code> 载入html文件。首先下载这两个loader:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev css-loader style-loader</span><br></pre></td></tr></table></figure>

<p>这时候更新我们的 <code>webpack.config.js</code>：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>); <span class="comment">// node-js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">"babel-loader"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">"style-loader"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;   </span><br><span class="line">                        loader: <span class="string">"css-loader"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这时候我们就可以看到我们的文件被成功编译了。但是，当我们跑localhost的时候，会发现并没有东西呈现出来。这时候我们就需要配置webpack去把我们刚刚生成的 <code>bundle.js</code> 放进 <code>&lt;script&gt;</code> tag以HTML的形式呈现，我们可以使用 <code>html-webpack-plugin</code> 来告诉webpack我们希望加载的HTML是 <code>index.html</code> ，并且我们希望将我们的react应用挂载在 <code>&lt;body&gt;</code> 里面:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install html-webpack-plugin --save-dev</span><br></pre></td></tr></table></figure>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>); <span class="comment">// node-js</span></span><br><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">'html-webpack-plugin'</span>)</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    mode: <span class="string">'development'</span>,</span><br><span class="line">    entry: <span class="string">'./src/index.js'</span>,</span><br><span class="line">    output: &#123;</span><br><span class="line">        path: path.resolve(__dirname, <span class="string">'dist'</span>),</span><br><span class="line">        filename: <span class="string">'bundle.js'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="built_in">module</span>: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: &#123;</span><br><span class="line">                    loader: <span class="string">"babel-loader"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                test: <span class="regexp">/\.css$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        loader: <span class="string">"style-loader"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    &#123;   </span><br><span class="line">                        loader: <span class="string">"css-loader"</span></span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    plugins: [</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            template: __dirname + <span class="string">'/src/index.html'</span>,</span><br><span class="line">            filename: <span class="string">'index.html'</span>,</span><br><span class="line">            inject: <span class="string">'body'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在跑一次 <code>npm start</code> 命令！恭喜！这时候一个简单的react应用就通过webpack生成了！</p>
<img src="/2020/07/21/%E5%85%B3%E4%BA%8EWebpack/success.PNG" class="">

<br/>
<br/>

<h2 id="4-参考资料"><a href="#4-参考资料" class="headerlink" title="4. 参考资料"></a>4. 参考资料</h2><ol>
<li><a href="https://webpack.docschina.org/concepts" target="_blank" rel="noopener">Webpack文档</a> </li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/07/21/%E5%85%B3%E4%BA%8EWebpack/" data-id="ckha7v7j2001r0qr742tr7n3m" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-关于Serverless的二三事-BFF" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/20/%E5%85%B3%E4%BA%8EServerless%E7%9A%84%E4%BA%8C%E4%B8%89%E4%BA%8B-BFF/" class="article-date">
  <time datetime="2020-07-20T14:15:32.000Z" itemprop="datePublished">2020-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/20/%E5%85%B3%E4%BA%8EServerless%E7%9A%84%E4%BA%8C%E4%B8%89%E4%BA%8B-BFF/">关于Serverless的二三事</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <br/>
<br/>

<p>因为被丢去写前端了嘛，必须使用一个公司内部的框架。研究了一阵子后发现有一个serverless的概念属于以前听说过，大致明白含义但是从来没有好好了解。决定开一个系列看看能不能讲明白。<br>在开始讲serverless之前，先谈一谈什么是Backend-for-Frontend(BFF)。</p>
<h2 id="1-什么是Backend-for-Frontend（BFF"><a href="#1-什么是Backend-for-Frontend（BFF" class="headerlink" title="1. 什么是Backend-for-Frontend（BFF)"></a>1. 什么是Backend-for-Frontend（BFF)</h2><p>在现有的结构里面，大部分的设计都是前端直接和后端API进行通信。在这种模式下，如果前端需要一些改动或者增加新的feature，就需要后端团队进行配合，至少得把API的接口设计好才可以继续进行开发。那么弊端就会出现了：</p>
<ul>
<li>资源调度问题：没有足够的人手进行后端开发</li>
<li>需求问题：该API也许是用于多平台多应用的开发，即别的平台/应用可能没有改动这个API的需求。不同的应用有不同的需求，该API可能无法满足所有的需求。从而需要进行“general”化。</li>
<li>管理问题：前端和后端团队的任务优先级不同等等<br>这些因素都可以导致开发周期延长，维护成本增加以及其他问题，于是就有了BFF，自如其名，即，专门为了前端而存在的“后端”或者说一个“中间件”。</li>
</ul>
<h3 id="传统意义上的前后端架构："><a href="#传统意义上的前后端架构：" class="headerlink" title="传统意义上的前后端架构："></a>传统意义上的前后端架构：</h3><img src="/2020/07/20/%E5%85%B3%E4%BA%8EServerless%E7%9A%84%E4%BA%8C%E4%B8%89%E4%BA%8B-BFF/backend-frontend.png" class="" title="backend-frontend">

<h3 id="BFF架构："><a href="#BFF架构：" class="headerlink" title="BFF架构："></a>BFF架构：</h3><img src="/2020/07/20/%E5%85%B3%E4%BA%8EServerless%E7%9A%84%E4%BA%8C%E4%B8%89%E4%BA%8B-BFF/backend-for-frontend-example.png" class="" title="backend-for-frontend-example">

<br/>

<p>可以很明显的看出，BFF pattern把一个很复杂的大型后端分解成了多个BFF。BFF设计模式旨在为所有API保留一个接口，并充当前端和API之间的转换层。它大部分时候是用来作为一个“转接器”，它会汇总所有downstream services的数据，并根据当前的前端设计进行数据转换。BFF本身并不实现业务应用逻辑，它仅仅是转换（transformation）和聚合（aggregation）。由于BFF是面向用户体验的，往往是由实现该部分UI的前端团队负责实现以及维护，即UI与BFF由同一个团队负责。前端团队往往更理解哪些数据是必要的，所以可以更好的理解需求以及实现数据转换。</p>
<p>一言以蔽之，BFF是一个解除后端API和前端UI耦合的设计。Decouple the backend API and frontend UI.</p>
<br/>
<br/>

<h2 id="2-BFF的架构"><a href="#2-BFF的架构" class="headerlink" title="2. BFF的架构"></a>2. BFF的架构</h2><p>在BFF里面，有三个主体：</p>
<ul>
<li>Backend： 后端。负责数据模型（data model），数据库交互等等。</li>
<li>BFF: 与后端交流，根据UI来定义或者调整API，简化Client Side（客户端）和Server Side（服务端）的发布流程，且负责提供一个API集合给对应的前端。</li>
<li>Frontend： 前端。负责UI。</li>
</ul>
<p>目前主要有两种架构BFF的方式：</p>
<ol>
<li>每一个前端团队都有自己的BFF。</li>
<li>所有的前端团队一起分享同一个BFF。</li>
</ol>
<h3 id="每一个前端团队都有自己的BFF"><a href="#每一个前端团队都有自己的BFF" class="headerlink" title="每一个前端团队都有自己的BFF"></a>每一个前端团队都有自己的BFF</h3><p>这种架构方式细化了每一个平台的需求。后端可以放心地提供信息，BFF部分则负责优化，转换。</p>
<img src="/2020/07/20/%E5%85%B3%E4%BA%8EServerless%E7%9A%84%E4%BA%8C%E4%B8%89%E4%BA%8B-BFF/backend_frontend_oneBFF.png" class="" title="backend frontend one BFF">

<h3 id="多个前端团队拥有同一个BFF"><a href="#多个前端团队拥有同一个BFF" class="headerlink" title="多个前端团队拥有同一个BFF"></a>多个前端团队拥有同一个BFF</h3><p>这种架构方式可以提高开发效率，因为所有的前端API需求都被放在一起集中开发。其实这种情况下，BFF就是一个API Gateway，它负责了对其他downstream service的对接。</p>
<img src="/2020/07/20/%E5%85%B3%E4%BA%8EServerless%E7%9A%84%E4%BA%8C%E4%B8%89%E4%BA%8B-BFF/backend-for-frontend-example.png" class="" title="backend-for-frontend-example">

<br/>
<br/>

<h2 id="3-BFF的具体实现与问题"><a href="#3-BFF的具体实现与问题" class="headerlink" title="3. BFF的具体实现与问题"></a>3. BFF的具体实现与问题</h2><p>关于BFF的实现，有三个问题要考虑：</p>
<ul>
<li>拆分程度</li>
<li>技术栈管理</li>
<li>复用问题</li>
</ul>
<h3 id="拆分程度"><a href="#拆分程度" class="headerlink" title="拆分程度"></a>拆分程度</h3><p>上面以及聊过两种不同的架构，那么在实现上，又有什么考虑呢？首先是拆分程度。既然我们要将一个大后端拆分成多个BFF，那么要根据什么来拆分呢：</p>
<ul>
<li>UX/UI：根据用户的交互体验。比如PC端的体验和移动端的体验不同，可以考虑拆分出2个BFF。</li>
<li>端级：根据不同的设备来进行拆分。比如iOS与Android同属于移动端，但是他们隶属于不同的前端设备，我们也可以根据这个来拆分。</li>
<li>团队：根据不同的团队来拆分。即每一个前端团队都拥有一个自己的BFF。</li>
</ul>
<p>通常情况下，我们会选择UX/UI来拆分。团队拆分很大程度上等同于UX/UI（但是还是看每个公司的组织结构），而端级的拆分很可能导致大量的代码重复，因为接口总是相同的。</p>
<h3 id="技术栈问题"><a href="#技术栈问题" class="headerlink" title="技术栈问题"></a>技术栈问题</h3><p>Mircoservice已然是行业的一个趋势，但是依赖问题始终令人头疼。在同一个生态下面的不同服务往往都有自己的通信和工作方式，常常需要依赖专门设计的接口进行通信。这种情况下，我们往往需要考虑：</p>
<ul>
<li>即如何对接不同的downstream service：对于不同的接口，我们是应该使用RPC协议，Rest还是GraphQL？</li>
<li>如何管理组合这些API：该如何合理进行异步的调用，如何引用事件机制（比如RX）将这些异步的控制流程进行简化？</li>
<li>当某一个API调用失败时，该如何应对：是否应该在BFF层引入容错？如何设计熔断、重试机制才能合理的保护整个系统？是否需要提供不完整的响应内容？</li>
<li>等等……</li>
</ul>
<h3 id="复用问题"><a href="#复用问题" class="headerlink" title="复用问题"></a>复用问题</h3><p>进行拆分就意味着重复逻辑的出现。一些通用逻辑比如：authentication，rate limit（限流）等等会导致大量的重复代码，并且重复代码就意味着我们难以保证统一更新以及使用起来有更高的学习曲线。由于我们是为了灵活性才拆分出多个BFF，这种情况下我们不可能再次将这些BFF合并。于是就需要多一个中间层进行通用逻辑的拆分：</p>
<ul>
<li>公共库</li>
<li>独立服务</li>
<li>downstream service（下游服务，依赖树中的一环）<br>问题又来了……抽取重复部分就会导致耦合……不管是什么解决方案，前提是<b>技术栈相同</b>以及<b>该冗余是不可以忍受的</b>。</li>
</ul>
<p>比较好的一个方案是直接使用网关，使用网关来进行一些基础功能比如routing，authentication&amp;authorization，monitor，rate limiting等等……</p>
<br/>
<br/>

<h2 id="4-业界实践"><a href="#4-业界实践" class="headerlink" title="4. 业界实践"></a>4. 业界实践</h2><img src="/2020/07/20/%E5%85%B3%E4%BA%8EServerless%E7%9A%84%E4%BA%8C%E4%B8%89%E4%BA%8B-BFF/BFF-implementation.png" class="">

<br/>
<br/>

<h2 id="5-参考资料"><a href="#5-参考资料" class="headerlink" title="5. 参考资料"></a>5. 参考资料</h2><ol>
<li><a href="https://www.cnblogs.com/alimayun/p/12063401.html" target="_blank" rel="noopener">微服务架构~BFF和网关是如何演化出来的</a> </li>
<li><a href="https://medium.com/blue-harvest-tech-blog/why-big-companies-and-rapidly-growing-startups-need-back-end-for-front-end-ee8e6ab8f575" target="_blank" rel="noopener">Why big companies and rapidly growing startups need Back-end for Front-end</a> </li>
<li><a href="https://cloud.tencent.com/developer/article/1444653" target="_blank" rel="noopener">Backend For Frontend (BFF)</a> </li>
<li><a href="https://nordicapis.com/building-a-backend-for-frontend-shim-for-your-microservices/" target="_blank" rel="noopener">Building a Backend for Frontend (BFF) For Your Microservices</a> </li>
<li><a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/backends-for-frontends" target="_blank" rel="noopener">Backends for Frontends pattern</a> </li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/07/20/%E5%85%B3%E4%BA%8EServerless%E7%9A%84%E4%BA%8C%E4%B8%89%E4%BA%8B-BFF/" data-id="ckha7v7ij000t0qr75of78kkb" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-理解CORS(1)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/19/%E7%90%86%E8%A7%A3CORS(1)/" class="article-date">
  <time datetime="2020-07-19T11:15:31.000Z" itemprop="datePublished">2020-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/19/%E7%90%86%E8%A7%A3CORS(1)/">理解CORS(1)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>一年前在另外一个团队做Gateway API的时候，曾经因为要满足SOC2而研究过这个主题，但并没有好好记录下来。一年后不幸地被抓去做一个前端项目的PoC，又需要使用相关知识，于是记录一番。</p>
<h2 id="1-Definition-of-an-origin（同源的定义）"><a href="#1-Definition-of-an-origin（同源的定义）" class="headerlink" title="1. Definition of an origin（同源的定义）"></a>1. Definition of an origin（同源的定义）</h2><p>在讨论跨域之前，我们首先要理解什么是“同源”，即same origin。首先，一个URL由以下几个部分组成：<br/><br><code>[schema]://[host]:[port]</code></p>
<p>以下为几个例子，方便理解：<br>我们以<code>http://account.example.com/home/index.html</code>为对象进行对比。</p>
<table>
<thead>
<tr>
<th align="left">URL</th>
<th align="center">是否同源</th>
<th align="left">备注</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>http://account.example.com/settings/one.html</code></td>
<td align="center">是</td>
<td align="left">Path并不属于同源比较对象。他们的schema，host与port完全温和所以不存在不同源的问题</td>
</tr>
<tr>
<td align="left"><code>http://account.example.com/logout.html</code></td>
<td align="center">是</td>
<td align="left">Path并不属于同源比较对象。他们的schema，host与port完全温和所以不存在不同源的问题</td>
</tr>
<tr>
<td align="left"><code>https://account.example.com/logout.html</code></td>
<td align="center">否</td>
<td align="left"><b>Schema</b>不同，一个是https一个是http</td>
</tr>
<tr>
<td align="left"><code>http://profile.example.com/logout.html</code></td>
<td align="center">否</td>
<td align="left"><b>Host</b>不同，一个是profile一个是account</td>
</tr>
<tr>
<td align="left"><code>http://account.example.com:1000/logout.html</code></td>
<td align="center">否</td>
<td align="left"><b>Port</b>不同，在http里面，默认的port是80，这个例子里是1000，所以不同源</td>
</tr>
</tbody></table>
<br/>
<br/>

<h2 id="2-跨域资源共享（CORS"><a href="#2-跨域资源共享（CORS" class="headerlink" title="2. 跨域资源共享（CORS)"></a>2. 跨域资源共享（CORS)</h2><p>在介绍完同源的定义后，我们可以开始了解什么是同源策略（Same-origin Policy）以及什么是跨域资源共享（CORS，Cross-Orgin Resource Sharing）。</p>
<ul>
<li><b>Same-origin policy</b>: 一个简单但重要的浏览器安全策略。即一个网站只可以从自己的服务器加载资源。这个策略可以结合一些其他的安全策略比如httpOnly用来防止一些危险比如CSRF攻击、XSS攻击。</li>
<li><b>CORS</b>: 一个用于处理跨域访问资源的标准、机制。Same-origin policy作为一个基本的保障用户安全的存在，它在一定程度上防止了恶意攻击，但是也限制了一些正常的访问。这就是为什么我们需要使用CORS来解决跨域问题。</li>
</ul>
<blockquote>
<p>但是需要注意的是，跨域嵌入是允许的。浏览器允许加载页面中嵌入的来自不同源的scripts（脚本），图片以及媒体文件。</p>
</blockquote>
<br/>
<br/>

<h2 id="3-进行跨域资源共享的主体与请求"><a href="#3-进行跨域资源共享的主体与请求" class="headerlink" title="3. 进行跨域资源共享的主体与请求"></a>3. 进行跨域资源共享的主体与请求</h2><p>首先，我们要理解该过程里面的两个主体：浏览器与服务器。<br>在整个CORS通信里面，前端开发者不需要进行任何操作，所有的设置将有浏览器自动完成，比如添加request headers，发送pre-flight request等。所以对于前端的开发者而言，是否启用CORS，他们的代码都将是一样的。与此不同的是，服务器端必须进行恰当的设置，CORS通信才可以实现。</p>
<p>其次，我们需要知道，在CORS里面有两种请求：简单请求（Simple Request）以及复杂请求（Complex Request）。</p>
<p><b>简单请求:</b></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">(1) Http Method必须满足以下任意一种:</span><br><span class="line">  1. HEAD</span><br><span class="line">  2. GET</span><br><span class="line">  3. POST</span><br><span class="line"></span><br><span class="line">(2) Http headers里面包含了以下一个或者更多：</span><br><span class="line">  1. Accept</span><br><span class="line">  2. Accept-Language</span><br><span class="line">  3. Content-Language</span><br><span class="line">  4. Content-Type （但仅限于application&#x2F;x-www-form-urlencoded, multipart&#x2F;form-data, text&#x2F;plain这三种)</span><br></pre></td></tr></table></figure>

<p><b>复杂请求：</b></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">所有不满足简单请求条件的都属于复杂请求。</span><br></pre></td></tr></table></figure>

<p>那么为什么浏览器需要区分这两种请求呢？原因是这两种请求的处理是不一样的：</p>
<ul>
<li>所有的简单请求都不会触发CORS preflighted request</li>
<li>任何可以不使用JavaScript也能触发的请求都属于简单请求，比如FORM POST或者使用<herf>的请求都是简单请求。且AJAX的跨域设计提到只要form可以发的请求，Ajax就可以发，而form一直都可以发出跨域请求，所以为了兼容form的设计，简单请求和复杂请求的处理也有不同的考虑。</li>
</ul>
<br/>
<br/>

<h2 id="4-跨域请求的流程"><a href="#4-跨域请求的流程" class="headerlink" title="4. 跨域请求的流程"></a>4. 跨域请求的流程</h2><h4 id="简单请求"><a href="#简单请求" class="headerlink" title="简单请求"></a>简单请求</h4><ol>
<li>当用户开启一个页面并发送一个Ajax请求，浏览器会自动帮忙在请求里面加上<code>Origin</code>这个header。</li>
<li>服务器会检查该header，并确认是否应该同意让该站点获取自己的资源。假如允许的话，则返回资源，并且response里面包含了<code>Access-Control-Allow-Origin: &lt;origin&gt;</code>这个header。</li>
<li>当浏览器收到response后，它会检查<code>Access-Control-Allow-Origin: &lt;origin&gt;</code>这个header并且确认该header是否与当前的源吻合。如果不是，则拦截该response，反之则通过。假如服务器返回的是<code>Access-Control-Allow-Origin: *</code>，浏览器则会自动通过该response。</li>
</ol>
<img src="/2020/07/19/%E7%90%86%E8%A7%A3CORS(1)/CORS_Sequence_Simple_Request.png" class="" title="sipmle request CORS flow">

<p>假设网站<code>http://a.example.com</code>想要访问<code>http://b.anotherexample.com</code>的资源，在没有设置CORS的情况下，则<code>http://a.example.com</code>会得到报错。而如果我们在<code>http://b.anotherexample.com</code>的服务器上设置了”Access-Control-Allow-Origin: *”则可以成功获得资源。简而言之，使用<code>Origin</code>与<code>Access-Control-Allow-Origin</code>就能完成最简单的CORS访问。在上图里面，服务器返回的是<code>Access-Control-Allow-Origin: *</code>，这代表了该资源可以被任意外域访问，这也就是为什么假如看到<code>*</code>，浏览器可以不需要检查。但是假如服务器端返回的是<code>Access-Control-Allow-Origin: http://a.example</code>这就代表了除了<code>http://a.example</code>其他外域均不允许访问该资源，这就是为什么浏览器会进行检查并且如果origin不一致就会拦截。</p>
<h4 id="复杂请求"><a href="#复杂请求" class="headerlink" title="复杂请求"></a>复杂请求</h4><ol>
<li>发送preflight request进行执行预检测。首先浏览器会使用<code>OPTIONS</code>方法发起该请求，服务器会告知浏览器是否允许该实际请求。<b>Preflight request实际上是用于避免CORS请求对于服务器的用户数据可能产生的未知影响。</b></li>
<li>假如服务器同意了该请求，则浏览器会重复简单请求的流程，发送真正的请求。</li>
</ol>
<img src="/2020/07/19/%E7%90%86%E8%A7%A3CORS(1)/CORS_Sequence_Complex_Request.png" class="" title="sipmle request CORS flow">

<p>从上图中，我们可以看出，我们将要发送的请求里面包含了一个自定义的header <code>X-PINGOTHER:pingpong</code>，于是需要进行预先检查：</p>
<table>
<thead>
<tr>
<th align="left">Header</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Access-Control-Request-Method: POST</code></td>
<td align="left">实际请求将会是POST，是否同意？</td>
</tr>
<tr>
<td align="left"><code>Access-Control-Request-Headers: X-PINGOTHER, Content-Type</code></td>
<td align="left">实际请求包含了<code>X-PINGOTHER</code>与<code>Content-Type</code>，是否同意？</td>
</tr>
</tbody></table>
<p>服务器检查后，返回说：</p>
<table>
<thead>
<tr>
<th align="left">Header</th>
<th align="left">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>Access-Control-Request-Method: POST, GET, OPTIONS</code></td>
<td align="left">可以使用<code>POST</code>，<code>GET</code>和<code>OPTIONS</code>发起请求</td>
</tr>
<tr>
<td align="left"><code>Access-Control-Request-Headers: X-PINGOTHER, Content-Type</code></td>
<td align="left">允许携带这两个headers</td>
</tr>
<tr>
<td align="left"><code>Access-Control-Max-Age: 86400</code></td>
<td align="left">这个response的有效时间是86400秒，即24个小时。在24个小时内，相同的请求不需要再一次发送preflight request。这个有效时间将由浏览器进行管理，如果超过了最大时间，则实际请求不会继续有效。需要重新发送preflight request。</td>
</tr>
</tbody></table>
<br/>
<br/>






      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/07/19/%E7%90%86%E8%A7%A3CORS(1)/" data-id="ckha7v7im000w0qr74zhlbeiw" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E5%85%A8%E6%80%A7/" rel="tag">安全性</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-理解OAuth2(1)" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/07/09/%E7%90%86%E8%A7%A3OAuth2(1)/" class="article-date">
  <time datetime="2020-07-09T16:59:27.000Z" itemprop="datePublished">2020-07-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/07/09/%E7%90%86%E8%A7%A3OAuth2(1)/">理解OAuth2(1)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <br/>
<br/>

<p>两三年前在创业公司的时候，曾经使用过OAuth2，虽然对流程有着大致的理解，但是很多词汇以及术语总是记不清楚。这次的项目又一次需要用到这方面的知识，于是打算好好记一下，也顺便整理思路，希望能把东西讲明白。</p>
<h2 id="1-OAuth2"><a href="#1-OAuth2" class="headerlink" title="1. OAuth2"></a>1. OAuth2</h2><p>OAuth2是目前较为流行的authorization机制，用来授权第三方应用，获得用户数据。</p>
<br/>
<br/>

<h2 id="2-Authorization-and-Authentication"><a href="#2-Authorization-and-Authentication" class="headerlink" title="2. Authorization and Authentication"></a>2. Authorization and Authentication</h2><p>最开始，我们先需要理解的是两个概念：</p>
<ul>
<li><b>Authentication:</b><br>Validating a user is the person he or she claims to be.<br>确认用户。证明自己是该用户，比如提供密码来证明我的确是该账号的使用者。</li>
<li><b>Authorization：</b><br>Validating what permission the user has.<br>确认用户权限。当一个用户证明了自己可以使用某应用后，他可以对该应用做什么。比如是普通用户，还是管理员等。</li>
</ul>
<p>打个比方，小明在公司是数据库管理员，小王在公司是财务。小明和小王都可以刷卡进公司系统，只需要他们证明自己是小明/小王即可，这就是authentication。<br>但是小明没有进入公司财务系统的权限，因为他不是财务。同样，小王也没有进入数据库的权限。这个就是他们的permission。所以只有在小明获得/展示他的数据库管理员的身份/职位的时候，他才会获得数据库的权限。这就是authorization。</p>
<br/>
<br/>

<h2 id="3-OAuth2-0-专业术语"><a href="#3-OAuth2-0-专业术语" class="headerlink" title="3. OAuth2.0 专业术语"></a>3. OAuth2.0 专业术语</h2><ul>
<li><b>Resource Owner:</b> 即用户，数据的拥有者。</li>
<li><b>Client:</b> 用户想要使用的应用、网站等。</li>
<li><b>Authorization Server:</b> 用户用来登录账户，提供权限的服务器。有的时候Authorization Server和Resource Server可以是同一个服务器。即该服务器既可以用来验证登录，也同时提供API服务。</li>
<li><b>Resource Server:</b> 存储用户数据或者提供用户数据的API的服务器。</li>
<li><b>Authorization Grant:</b> 这个Grant是一个凭证，它证明了用户同意该应用使用她/他的账户信息。</li>
<li><b>Redirect URI:</b> 当用户同意登录后，跳转回该URI。</li>
<li><b>Access Token:</b> 这个令牌可以证明请求是有效的。应用可以使用该令牌去Resource Server请求一些必需的用户资料（用户在Authorization Server已经同意了给予该权限）。</li>
<li><b>Scope:</b> 定义了该应用可以获得的用户资源。比如可以获得头像信息，邮箱信息或者全部信息等等。</li>
</ul>
<p>一个很简单的场景。我想在lofter.com上发表文章，但是我不想在lofter上面注册lofter专用的账号了，我希望使用我的google账号来登录lofter.com并发表文章，于是我们有的下面的流程:<br>用户（<u>Resource Owner</u>）在浏览器输入”lofter.com”进入lofter网站（<u>Client</u>），点击“登录”，网站会跳转到”accounts.google.com”（<u>Authorization Server</u>)，google的登录界面出现，并显示出lofter想要使用的用户权限，比如获取头像信息，用户名（这些就是<u>scope</u>）等等，当用户同意，根据lofter的设置，用户会被带回lofter的<u>Redirect URI</u>且此时lofter获得了用户通过google颁发的凭证（<u>Authorization Grant</u>），通过这个凭证， lofter会再一次与”accounts.google.com”对话，交换<u>Access Token</u>，接下来，凭借着该<u>Access Token</u>，lofter就可以与<u>Resource Server</u>通信并获得头像信息以及用户名了。</p>
<br/>
<br/>

<h2 id="4-Grant-Type-（授权模式）"><a href="#4-Grant-Type-（授权模式）" class="headerlink" title="4. Grant Type （授权模式）"></a>4. Grant Type （授权模式）</h2><p>在上面的场景中，我们注意到Authorization Grant的存在，即凭证、授权。并且，我们需要使用该凭证来换取令牌（Access Token）。这是为什么呢？<br>因为现实生活里面，不同的应用有不同的设计，有的网站可能是纯单界面应用（Single Page Application），或者Serverless，又或者是手机应用，它们有的只有前端没有服务器，有的有自己的服务器，这样的情况下，就导致了流程里某些需要使用服务器来储存获得安全性的设计无法实现。于是OAuth2.0里面就有了不同的Grant Type，来确保不同的应用可以选择适合自己的验证流程。</p>
<p>目前常用的OAuth Grant Types有：</p>
<ul>
<li><b>Authorization Code （授权码模式）:</b><br>功能最完整，流程最严密的授权模式。在authorization server真正提供access token之前，client必须获得authorization code，获得了code后，client再次向authorization server进行access token exchange，并且该步骤是在后台服务器上执行的，对用户完全不可见，因此获得了一定的安全性。</li>
<li><b>Implicit Grant（简化模式）：</b><br>该模式下，申请access token并不需要通过后台服务器，因此属于authorization code的简化版本。当用户在authorization server上同意了授权后，返回redirect URI的时候，URI里面的Hash部分已经包含了access token（从而省略了使用authorization code交换token这个步骤）。</li>
<li><b>Client Credentials</b> </li>
<li><b>Resource Owner Password Credentials</b> </li>
</ul>
<br/>
<br/>

<h2 id="5-OAuth2-0-Authorization-Code-Flow"><a href="#5-OAuth2-0-Authorization-Code-Flow" class="headerlink" title="5. OAuth2.0 Authorization Code Flow"></a>5. OAuth2.0 Authorization Code Flow</h2><p>下图为OAuth2.0 authorization code的简易流程。</p>
<img src="/2020/07/09/%E7%90%86%E8%A7%A3OAuth2(1)/oauth2_authorization_code_flow.png" class="" title="This shows the authorization code flow">

<br/>
<br/>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2020/07/09/%E7%90%86%E8%A7%A3OAuth2(1)/" data-id="ckha7v7in000y0qr7b13gbjeo" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%8D%8F%E8%AE%AE/" rel="tag">协议</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AE%89%E5%85%A8%E6%80%A7/" rel="tag">安全性</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-理解Vue的Render渲染函数" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/09/19/%E7%90%86%E8%A7%A3Vue%E7%9A%84Render%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0/" class="article-date">
  <time datetime="2018-09-19T10:02:11.000Z" itemprop="datePublished">2018-09-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/09/19/%E7%90%86%E8%A7%A3Vue%E7%9A%84Render%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0/">理解Vue的Render渲染函数</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <br/>
<br/>
<br/>
<br/>
最近在尝试将Vue的SSR与.Net Core的Js SSR Middleware结合，让纯客户端应用转变为服务端渲染。发现自己对Vue的render函数很不了解，所以打算好好整理一下，至少理解个大概。
<br/>
<br/>

<h2 id="1-HTML、节点与树（HTML-Nodes-and-Tree）"><a href="#1-HTML、节点与树（HTML-Nodes-and-Tree）" class="headerlink" title="1. HTML、节点与树（HTML, Nodes and Tree）"></a>1. HTML、节点与树（HTML, Nodes and Tree）</h2><p>首先，Vue的<a href="https://cn.vuejs.org/v2/guide/render-function.html" target="_blank" rel="noopener">官方文档</a>里提供了关于浏览器的“<a href="https://javascript.info/dom-nodes" target="_blank" rel="noopener">DOM Tree</a>”工作原理。</p>
<blockquote>
<p>每个元素都是一个节点。每片文字也是一个节点。甚至注释也都是节点。一个节点就是页面的一个部分。就像家谱树一样，每个节点都可以有孩子节点 (也就是说每个部分可以包含其它的一些部分)。</p>
</blockquote>
<p>最中心的思想则是：</p>
<blockquote>
<p>if something’s in HTML, then it also must be in the DOM tree.</p>
</blockquote>
<p>于是我们知道，对于浏览器而言，当它读到一段HTML代码，它会将这段HTML转成一个“DOM Tree（节点树）”。<br><br/><br><br/></p>
<h2 id="2-什么是render（渲染）函数呢？"><a href="#2-什么是render（渲染）函数呢？" class="headerlink" title="2. 什么是render（渲染）函数呢？"></a>2. 什么是render（渲染）函数呢？</h2><p>Vue是通过 template（字符串模板）来创建HTML的。render函数与 template 十分相似，都是用来高效的更新所有这些节点的——准确的说，<a href="https://cn.vuejs.org/v2/api/#render" target="_blank" rel="noopener">render函数是字符串模板的代替方案，允许你发挥 JavaScript 最大的编程能力。</a><br><br/><br><br/></p>
<h2 id="3-虚拟DOM（The-Virtual-DOM）"><a href="#3-虚拟DOM（The-Virtual-DOM）" class="headerlink" title="3. 虚拟DOM（The Virtual DOM）"></a>3. 虚拟DOM（The Virtual DOM）</h2><p>在了解了到底什么是render函数之后，下一步是理解这个函数如何工作的。</p>
<blockquote>
<p>该渲染函数接收一个 createElement 方法作为第一个参数用来创建 VNode。如果组件是一个函数组件，渲染函数还会接收一个额外的 context 参数，为没有实例的函数组件提供上下文信息。</p>
</blockquote>
<p>创建VNode，即Vue通过建立一个虚拟 DOM 对真实 DOM 发生的变化保持追踪。createElement 方法会返回一段信息，该信息会告诉 Vue 页面上需要渲染什么样的节点，及其子节点。而具体createElement 方法可能又需要另外一篇文章来解析了。又需要提及的是，Vue 的模板实际是编译成了 render 函数，一言以盖之，Vue利用render函数来创造真正的DOM Tree。<br><br/><br><br/></p>
<h2 id="4-Vue-的渲染机制"><a href="#4-Vue-的渲染机制" class="headerlink" title="4. Vue 的渲染机制"></a>4. Vue 的渲染机制</h2><p>所以，Vue的渲染机制大致上可以这么说：<br>template → render function → virutal DOM → real DOM<br>template会被编译成render funciton， render function会创建虚拟DOM，虚拟DOM最后影响创造真实的DOM Tree。</p>
<p>这里又可以提一下Vue的两个构建概念：<u>独立构建</u>与<u>运行时构建</u>。*<br>独立构建：包含模板编译器，渲染过程HTML字符串 → render函数 → VNode → 真实DOM节点<br>运行时构建：不包含模板编译器，渲染过程render函数 → VNode → 真实DOM节点<br>通过比较可以注意到，独立构建多了一个模板编译器。所以直接使用render函数可以做到省去编译器只使用运行时版本。<br><br/><br><br/></p>
<h2 id="5-总结"><a href="#5-总结" class="headerlink" title="5. 总结"></a>5. 总结</h2><p>在读了官方文档、网上关于render function的文章以及稍作总结后，个人总结render函数其实是Vue 将HTML字符串，或者Js funciton、object转化成真正的DOM的一个中介。所以需要深入理解 createElement 到底可以接收什么参数以及 Virtual DOM 是如何作用的。</p>
<p>*做笔记的时候发现 createElement 和 VNode 是两个很核心的知识点。应该需要用另外了解。<br><br/><br><br/><br><br/><br><br/></p>
<p>参考文章</p>
<ul>
<li><a href="https://vuejs.org/v2/guide/render-function.html" target="_blank" rel="noopener">Vue官方文档—Render Functions &amp; JSX</a></li>
<li><a href="https://www.w3cplus.com/vue/vue-render-function.html" target="_blank" rel="noopener">Vue 2.0学习笔记：Vue的render函数</a></li>
<li><a href="https://segmentfault.com/a/1190000008291645" target="_blank" rel="noopener">Vue原理解析之Virtual Dom</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://shimingwu.github.io/2018/09/19/%E7%90%86%E8%A7%A3Vue%E7%9A%84Render%E6%B8%B2%E6%9F%93%E5%87%BD%E6%95%B0/" data-id="ckha7v7io00100qr75p4dbjp3" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/VueJs/" rel="tag">VueJs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li></ul>

    </footer>
  </div>
  
</article>


  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Algorithm/" rel="tag">Algorithm</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Big-Data/" rel="tag">Big Data</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/LeetCode/" rel="tag">LeetCode</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/VueJs/" rel="tag">VueJs</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%89%8D%E7%AB%AF/" rel="tag">前端</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%8D%8F%E8%AE%AE/" rel="tag">协议</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AE%89%E5%85%A8%E6%80%A7/" rel="tag">安全性</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%B7%A5%E5%85%B7/" rel="tag">工具</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9E%B6%E6%9E%84/" rel="tag">架构</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%AE%97%E6%B3%95/" rel="tag">算法</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Algorithm/" style="font-size: 15px;">Algorithm</a> <a href="/tags/Big-Data/" style="font-size: 20px;">Big Data</a> <a href="/tags/LeetCode/" style="font-size: 15px;">LeetCode</a> <a href="/tags/VueJs/" style="font-size: 10px;">VueJs</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 20px;">前端</a> <a href="/tags/%E5%8D%8F%E8%AE%AE/" style="font-size: 10px;">协议</a> <a href="/tags/%E5%AE%89%E5%85%A8%E6%80%A7/" style="font-size: 15px;">安全性</a> <a href="/tags/%E5%B7%A5%E5%85%B7/" style="font-size: 10px;">工具</a> <a href="/tags/%E6%9E%B6%E6%9E%84/" style="font-size: 10px;">架构</a> <a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 15px;">算法</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/09/BigData-3/">BigData(3)</a>
          </li>
        
          <li>
            <a href="/2020/11/08/BigData-2/">BigData(2)</a>
          </li>
        
          <li>
            <a href="/2020/11/08/BigData-1/">BigData(1)</a>
          </li>
        
          <li>
            <a href="/2020/09/26/LeetCode-Largest-Number/">LeetCode Largest Number</a>
          </li>
        
          <li>
            <a href="/2020/09/22/LeetCode-Majority-Element-II/">LeetCode(229) Majority Element II</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 Shiming Wu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>